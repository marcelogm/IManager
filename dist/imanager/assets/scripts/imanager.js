function selectDisplay(e) { var i = $(e).attr("id"), a = ".image-info-" + i, n = $(a).find("#path").val(), o = $(a).find("#thumb").val(), t = $(a).find("#width").val() + "x" + $(a).find("#height").val(); $("#implugin-selected").val(i), $(".image-info-display #name").html($(a).find("#name").val()), $(".image-info-display #type").html($(a).find("#type").val()), $(".image-info-display #size").html($(a).find("#size").val()), $(".image-info-display #dimensions").html(t), $(".image-info-display #thumb").val(o), $(".image-info-display #path").val(n), $("#btn-img-download").attr("href", n), $(".image-info-gallery").attr("src", o), $(".image-info-display #created").html($(a).find("#created").val()) } function requestForm(e) { var i = {}; return i["implugin-secret-key"] = $("#implugin-secret-key").val(), i["implugin-selected-action"] = e, i } function sendFormMultipart(e, i, a, n) { loading(), n.preventDefault(), $(this).unbind(), $.ajax({ type: "POST", url: BASE_URL + "api/index.php", cache: !1, contentType: !1, processData: !1, data: e }).done(function (e, n) { "success" == n ? loadContent(i, a) : e = ERROR_MESSAGE, showMessage(e) }).fail(function () { showMessage(ERROR_MESSAGE), loadingComplete() }) } function sendForm(e, i, a, n) { loading(), n.preventDefault(), $(this).unbind(), $.ajax({ type: "POST", url: BASE_URL + "api/index.php", data: e }).done(function (e, n) { "success" == n ? loadContent(i, a) : e = ERROR_MESSAGE, showMessage(e) }).fail(function () { showMessage(ERROR_MESSAGE), loadingComplete() }) } function loadContent(e, i, a, n) { if ($(e).html(""), void 0 == n) var n = !0; if (void 0 == a) var a = requestForm(i); 1 == n && loading(), $.ajax({ type: "POST", url: BASE_URL + "api/index.php", data: a }).done(function (i, a) { "success" == a ? $(e).html(i) : $(e).html(ERROR_ALERT), loadingComplete() }).fail(function () { $(e).html(ERROR_ALERT), loadingComplete() }) } function appendContent(e, i, a, n) { if ($(e).append(""), void 0 == n) var n = !0; if (void 0 == a) var a = requestForm(i); 1 == n && loading(), $.ajax({ type: "POST", url: BASE_URL + "api/index.php", data: a }).done(function (i, a) { "success" == a ? $(e).append(i) : $(e).append(ERROR_ALERT), loadingComplete() }).fail(function () { $(e).append(ERROR_ALERT), loadingComplete() }) } function loadModal(e, i) { if ($("#feedback-modal-content").html(""), void 0 == i) var i = !0; 1 == i && loading(), $.ajax({ type: "POST", url: BASE_URL + "api/index.php", data: e }).done(function (e, i) { showMessage("success" == i ? e : ERROR_MESSAGE), loadingComplete() }).fail(function () { showMessage(ERROR_MESSAGE), loadingComplete() }) } function showMessage(e) { $("#feedback-modal-content").html(e), $("#feedback-modal").modal("show") } function loading() { $(".loading").show(500) } function loadingComplete() { $(".loading").hide(500) } function getUrlParam(e) { var i = new RegExp("(?:[?&]|&)" + e + "=([^&]+)", "i"), a = window.location.search.match(i); return a && a.length > 1 ? a[1] : null } function returnFileUrl() { var e = getUrlParam("CKEditorFuncNum"), i = $(".image-info-display #path").val(); window.opener.CKEDITOR.tools.callFunction(e, i), window.close() } const BASE_URL = $("#implugin-base-path").val() + "imanager/", ERROR_MESSAGE = '<p style="margin: 15px;">Há um problema com sua conexão com a internet, tente novamente mais tarde.</p>', ERROR_ALERT = '<div class="container"><div class="alert alert-danger" role="alert"><p>Há um problema com sua conexão com a internet, tente novamente mais tarde.</p></div></div>', MODAL_NAME = "#imanager-modal"; $(document).ready(function () { loadContent(".image-panel", "load-image-list") }), $(document).click(function (e) { var i = $(e.target); return i.closest(".thumbnail").length > 0 || i.closest(".image-info-footer").length > 0 ? !0 : void $(".image").removeClass("selected") }), $("body").on("mouseenter", ".image", function (e) { $(".image-info-footer").fadeIn(500), $(".selected").length || (selectDisplay(this), e.preventDefault()) }), $("body").on("mouseleave", ".image", function (e) { e.preventDefault() }), $("body").on("click", ".image", function (e) { var i = $(e.target), a = i.closest(".selected").length > 0, n = i.closest(".image").length > 0; $(".image").removeClass("selected"), a || $(this).addClass("selected"), n && (selectDisplay(this), e.preventDefault()) }), $("body").on("click", ".overlay", function () { showMessage('<img src="' + $(".image-info-display #path").val() + '" style="max-width: 100%;" />') }), $("body").on("click", "#btn-img-select", function () { returnFileUrl() }), $("body").on("click", "#btn-img-upload", function () { $.FileDialog({ accept: ["image/png", "image/jpeg", "image/gif"], cancel_button: "Fechar", drag_message: "Arraste e solte seus arquivos aqui.", error_message: "Ocorreu um problema ao carregar a imagem", remove_message: "Remover arquivo", title: "Enviar arquivos" }) }), $("body").on("click", ".btn-img-more", function () { var e = requestForm("load-image-list"); e["implugin-search"] = $(".current-search").val(), e["implugin-page"] = $(".btn-img-more").attr("id"), $(".more").remove(), appendContent(".image-panel", "", e) }), $("body").on("click", "#btn-img-search", function () { var e = requestForm("load-image-list"); e["implugin-search"] = $("#implugin-search").val(), loadContent(".image-panel", "", e) }), $("body").on("click", "#btn-img-edit", function () { var e = requestForm("edit-image"); e["implugin-id"] = $("#implugin-selected").val(), loadModal(e, !0) }), $("body").on("click", "#btn-img-edit-confirm", function (e) { var i = requestForm("edit-image"); i["implugin-id"] = $("#implugin-selected").val(), i["implugin-name"] = $("#edit-image-name").val(), i["implugin-confirm-action"] = !0, sendForm(i, ".image-panel", "load-image-list", e), $(".image-info-footer").fadeOut(500) }), $("body").on("keypress", "#edit-image-name", function (e) { return 13 == e.which ? (e.preventDefault(), void $("#btn-img-edit-confirm").click()) : void 0 }), $("#feedback-modal").on("shown.bs.modal", function () { $(this).find("[autofocus]").focus() }), $("body").on("click", "#btn-img-delete", function () { var e = requestForm("delete-image"); e["implugin-id"] = $("#implugin-selected").val(), loadModal(e, !0) }), $("body").on("click", "#btn-img-delete-confirm", function (e) { var i = requestForm("delete-image"); i["implugin-id"] = $("#implugin-selected").val(), i["implugin-confirm-action"] = !0, sendForm(i, ".image-panel", "load-image-list", e), $(".image-info-footer").fadeOut(500) }), $("body").on("files.bs.filedialog", function (e) { var i = new FormData; i.append("implugin-secret-key", $("#implugin-secret-key").val()), i.append("implugin-selected-action", "upload-image"), $.each(e.files, function (e, a) { i.append("implugin-file-" + e, a) }), sendFormMultipart(i, ".image-panel", "load-image-list", e) });