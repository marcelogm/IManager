const BASE_URL=$('#implugin-base-path').val()+'imanager/';const ERROR_MESSAGE='<p style="margin: 15px;">Há um problema com sua conexão com a internet, tente novamente mais tarde.</p>';const ERROR_ALERT='<div class="container"><div class="alert alert-danger" role="alert"><p>Há um problema com sua conexão com a internet, tente novamente mais tarde.</p></div></div>';const MODAL_NAME='#imanager-modal';$(document).ready(function(ev){loadContent('.image-panel','load-image-list');});$(document).click(function(ev){var self=$(ev.target);if(self.closest('.thumbnail').length>0||self.closest('.image-info-footer').length>0){return true;} $('.image').removeClass('selected');});$('body').on('mouseenter','.image',function(ev){$('.image-info-footer').fadeIn(500);if(!$('.selected').length){selectDisplay(this);ev.preventDefault();}});$('body').on('mouseleave','.image',function(ev){ev.preventDefault();});$('body').on('click','.image',function(ev){var self=$(ev.target);var selected=(self.closest('.selected').length>0);var is_item=(self.closest('.image').length>0);$('.image').removeClass('selected');if(!selected){$(this).addClass('selected');} if(is_item){selectDisplay(this);ev.preventDefault();}});$('body').on('click','.overlay',function(ev){showMessage('<img src="'+$('.image-info-display #path').val()+'" style="max-width: 100%;" />');});$('body').on('click','#btn-img-select',function(ev){returnFileUrl();});$('body').on('click','#btn-img-upload',function(ev){$.FileDialog({accept:['image/png','image/jpeg','image/gif'],cancel_button:"Fechar",drag_message:'Arraste e solte seus arquivos aqui.',error_message:'Ocorreu um problema ao carregar a imagem',remove_message:'Remover arquivo',title:'Enviar arquivos'});});$('body').on('click','.btn-img-more',function(ev){var data=requestForm('load-image-list');data['implugin-search']=$('.current-search').val();data['implugin-page']=$('.btn-img-more').attr('id');$('.more').remove();appendContent('.image-panel','',data);});$('body').on('click','#btn-img-search',function(ev){var data=requestForm('load-image-list');data['implugin-search']=$('#implugin-search').val();loadContent('.image-panel','',data);});$('body').on('click','#btn-img-edit',function(ev){var data=requestForm('edit-image');data['implugin-id']=$('#implugin-selected').val();loadModal(data,true);});$('body').on('click','#btn-img-edit-confirm',function(ev){var data=requestForm('edit-image');data['implugin-id']=$('#implugin-selected').val();data['implugin-name']=$('#edit-image-name').val();data['implugin-confirm-action']=true;sendForm(data,'.image-panel','load-image-list',ev);$('.image-info-footer').fadeOut(500);});$('body').on('keypress','#edit-image-name',function(ev){if(ev.which==13){ev.preventDefault();$('#btn-img-edit-confirm').click();return;}});$('#feedback-modal').on('shown.bs.modal',function(){$(this).find('[autofocus]').focus();});$('body').on('click','#btn-img-delete',function(ev){var data=requestForm('delete-image');data['implugin-id']=$('#implugin-selected').val();loadModal(data,true);});$('body').on('click','#btn-img-delete-confirm',function(ev){var data=requestForm('delete-image');data['implugin-id']=$('#implugin-selected').val();data['implugin-confirm-action']=true;sendForm(data,'.image-panel','load-image-list',ev);$('.image-info-footer').fadeOut(500);});$('body').on('files.bs.filedialog',function(ev){var data=new FormData();data.append('implugin-secret-key',$('#implugin-secret-key').val());data.append('implugin-selected-action','upload-image');$.each(ev.files,function(i,file){data.append('implugin-file-'+i,file);});sendFormMultipart(data,'.image-panel','load-image-list',ev);});function selectDisplay(self) {var id=$(self).attr('id');var from='.image-info-'+id;var path=$(from).find('#path').val();var thumb=$(from).find('#thumb').val();var dimensions=$(from).find('#width').val()+'x'+$(from).find('#height').val();$('#implugin-selected').val(id);$('.image-info-display #name').html($(from).find('#name').val());$('.image-info-display #type').html($(from).find('#type').val());$('.image-info-display #size').html($(from).find('#size').val());$('.image-info-display #dimensions').html(dimensions);$('.image-info-display #thumb').val(thumb);$('.image-info-display #path').val(path);$('#btn-img-download').attr('href',path);$('.image-info-gallery').attr('src',thumb);$('.image-info-display #created').html($(from).find('#created').val());} function requestForm(method) {var data={};data['implugin-secret-key']=$('#implugin-secret-key').val();data['implugin-selected-action']=method;return data;} function sendFormMultipart(data,contentTarget,response_method,event){loading();event.preventDefault();$(this).unbind();$.ajax({type:'POST',url:BASE_URL+'api/index.php',cache:false,contentType:false,processData:false,data:data}).done(function(response,code){if(code=='success'){loadContent(contentTarget,response_method);}else{response=ERROR_MESSAGE;} showMessage(response);}).fail(function(response,code){showMessage(ERROR_MESSAGE);loadingComplete();})} function sendForm(data,contentTarget,response_method,event){loading();event.preventDefault();$(this).unbind();$.ajax({type:'POST',url:BASE_URL+'api/index.php',data:data}).done(function(response,code){if(code=='success'){loadContent(contentTarget,response_method);}else{response=ERROR_MESSAGE;} showMessage(response);}).fail(function(response,code){showMessage(ERROR_MESSAGE);loadingComplete();})} function loadContent(target,method,data,loading_bar){$(target).html('');if(loading_bar==undefined){var loading_bar=true;} if(data==undefined){var data=requestForm(method);} if(loading_bar==true){loading();} $.ajax({type:'POST',url:BASE_URL+'api/index.php',data:data}).done(function(result,code){if(code=='success'){$(target).html(result);}else{$(target).html(ERROR_ALERT);} loadingComplete();}).fail(function(result){$(target).html(ERROR_ALERT);loadingComplete();});} function appendContent(target,method,data,loading_bar){$(target).append('');if(loading_bar==undefined){var loading_bar=true;} if(data==undefined){var data=requestForm(method);} if(loading_bar==true){loading();} $.ajax({type:'POST',url:BASE_URL+'api/index.php',data:data}).done(function(result,code){if(code=='success'){$(target).append(result);}else{$(target).append(ERROR_ALERT);} loadingComplete();}).fail(function(result){$(target).append(ERROR_ALERT);loadingComplete();});} function loadModal(data,loading_bar){$('#feedback-modal-content').html('');if(loading_bar==undefined){var loading_bar=true;} if(loading_bar==true){loading();} $.ajax({type:'POST',url:BASE_URL+'api/index.php',data:data}).done(function(result,code){if(code=='success'){showMessage(result);}else{showMessage(ERROR_MESSAGE);} loadingComplete();}).fail(function(result){showMessage(ERROR_MESSAGE);loadingComplete();});} function showMessage(message){$('#feedback-modal-content').html(message);$('#feedback-modal').modal('show');} function loading(){$('.loading').show(500);} function loadingComplete(){$('.loading').hide(500);} function getUrlParam(paramName){var reParam=new RegExp('(?:[?&]|&)'+paramName+'=([^&]+)','i');var match=window.location.search.match(reParam);return(match&&match.length>1)?match[1]:null;} function returnFileUrl(){var funcNum=getUrlParam('CKEditorFuncNum');var fileUrl=$('.image-info-display #path').val();window.opener.CKEDITOR.tools.callFunction(funcNum,fileUrl);window.close();}